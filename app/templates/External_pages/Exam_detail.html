<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>{{ exam.title }}</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='bootstrap.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='External/Exam.css') }}">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <!-- navbar -->
    {% include 'nav.html' %}

    <div class="container mt-5">
        <h1>{{ exam.title }}</h1>
        <p>{{ exam.description }}</p>

        <form id="examForm" action="{{ url_for('exams.submit_exam', exam_id=exam.id) }}" method="POST">
            {% for question in exam.questions %}
                <div class="mb-3">
                    <h4>{{ question.question_text }}</h4>
                    {% if question.question_image %}
                        <img src="{{ url_for('static', filename=question.question_image) }}" alt="Question Image" style="max-width: 100px;">
                    {% endif %}
                    {% for choice in question.choices %}
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="question_{{ question.id }}" id="choice_{{ choice.id }}" value="{{ choice.choice_text }}">
                            <label class="form-check-label" for="choice_{{ choice.id }}">
                                {{ choice.choice_text }}
                                {% if choice.choice_image %}
                                    <img src="{{ url_for('static', filename=choice.choice_image) }}" alt="Choice Image" style="max-width: 100px;">
                                {% endif %}
                            </label>
                        </div>
                    {% endfor %}
                </div>
            {% endfor %}
            <button type="button" class="btn btn-primary" onclick="submitExam()">Submit Exam</button>
        </form>
    </div>

    {% include 'footer.html' %}
    <script src="{{ url_for('static', filename='js/popper.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/jquery-3.7.1.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/bootstrap.js') }}"></script>

    <script>
        function submitExam() {
            const form = document.getElementById('examForm');
            const formData = new FormData(form);
            const data = {};

            // Convert FormData to a plain object
            formData.forEach((value, key) => {
                data[key] = value;
            });

            // Send data to the server
            fetch('{{ url_for("exams.submit_exam", exam_id=exam.id) }}', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    
                },
                body: JSON.stringify(data)
            })
            .then(response => response.json())
            .then(result => {
                alert(result.message || 'Exam submitted successfully!');
                if (result.redirect) {
                    window.location.href = result.redirect;
                }
            })
            .catch(error => console.error('Error:', error));
        }
    </script>
    
</body>
</html>
